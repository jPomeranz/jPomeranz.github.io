import{r as d,j as e}from"./index-R3Gpo62y.js";const g=({isOpen:a,onClose:s,children:t})=>(d.useEffect(()=>{if(!a)return;const r=m=>{m.key==="Escape"&&s()};return document.addEventListener("keydown",r),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",r),document.body.style.overflow="unset"}},[a,s]),a?e.jsx("div",{className:"modal-overlay",onClick:s,children:e.jsxs("div",{className:"modal-content",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{className:"modal-close",onClick:s,children:"×"}),t]})}):null),f=a=>{const s=a.split(" by ");return{title:s[0].trim(),author:s[1]?.trim()||""}},w=()=>{const[a,s]=d.useState([]),[t,r]=d.useState(null),[m,k]=d.useState(!1),[u,h]=d.useState(null);d.useEffect(()=>{(async()=>{const i=await(await fetch("/books.txt")).text();s(i.split(`
`).filter(o=>o.trim()))})()},[]);const b=async(n,l)=>{const i=l?`title=${encodeURIComponent(n)}&author=${encodeURIComponent(l)}`:`title=${encodeURIComponent(n)}`,o=await fetch(`https://openlibrary.org/search.json?${i}&fields=key,title,author_name,cover_i&limit=1`);if(!o.ok)throw new Error(`API error: ${o.status}`);const c=(await o.json()).docs?.[0];return c?{title:c.title,authors:c.author_name,thumbnail:c.cover_i?`https://covers.openlibrary.org/b/id/${c.cover_i}-M.jpg`:void 0,infoLink:`https://openlibrary.org${c.key}`}:null},x=async n=>{const{title:l,author:i}=f(n);k(!0),h(null);try{const o=await b(l,i);o?r(o):h("Book information not found")}catch(o){const p=o instanceof Error?o.message:String(o);h(`Failed to fetch book information: ${p}`)}finally{k(!1)}},j=()=>{r(null),h(null)},y=m||!!u||!!t,v=m?e.jsx("div",{className:"loading",children:"Loading book information..."}):u?e.jsx("div",{className:"error-message",children:u}):t?e.jsxs("div",{className:"modal-body",children:[t.thumbnail&&e.jsx("img",{src:t.thumbnail.startsWith("http:")?t.thumbnail.replace(/^http:/,"https:"):t.thumbnail,alt:t.title,className:"book-thumbnail"}),e.jsxs("div",{className:"book-details",children:[e.jsx("h2",{children:t.title}),t.authors&&e.jsxs("p",{className:"book-authors",children:["by ",t.authors.join(", ")]}),t.infoLink&&e.jsx("a",{href:t.infoLink,target:"_blank",rel:"noopener noreferrer",className:"view-link",children:"View on Open Library →"})]})]}):null;return e.jsxs("div",{className:"books-page",children:[e.jsx("div",{className:"container",style:{marginTop:"2em",marginLeft:"0.5em"},children:e.jsx("h1",{children:"Books"})}),e.jsx("ul",{className:"books-list",children:a.map((n,l)=>{const{title:i,author:o}=f(n);return e.jsxs("li",{className:"book-item",onClick:()=>x(n),children:[e.jsx("span",{className:"book-title",children:i}),o&&e.jsxs("span",{className:"book-author",children:["by ",o]})]},l)})}),e.jsx(g,{isOpen:y,onClose:j,children:v})]})};export{w as default};
